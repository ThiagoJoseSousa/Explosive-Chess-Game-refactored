(()=>{"use strict";!function(){const t=document.querySelector(".hamburguer"),e=document.querySelector(".nav-list");t.addEventListener("click",(()=>{t.classList.toggle("active"),e.classList.toggle("active")}))}(),function(){const t=document.getElementsByClassName("nav-item"),e=document.querySelectorAll("section");for(let e=0;e<t.length;e++)t[e].addEventListener("click",s);function s(t){for(let t=0;t<e.length;t++)e[t].classList.add("notcurrent");e[t.target.dataset.page].classList.remove("notcurrent")}}(),function(){const t=document.getElementById("white-start"),e=document.getElementById("black-start"),s=document.getElementById("chooseSide");function i(t){s.classList.add("hidden"),console.log(t.target.id.slice(0,5)+" is human");let e=new(function(){class t{constructor(t){this.color=t,this.human=!1,this.pieces=[]}humanCanClick(t){this.pieces.forEach((e=>{if(!e.dead){let s=document.querySelector(`[data-coords="${e.coords[0]}${e.coords[1]}"]`);s.classList.add("clickablePiece"),s.addEventListener("click",(()=>{this.displayPossibilities(e,t)}))}}))}displayPossibilities(t,e){this.clearPossibilities(),this.displaying=t;let s=`${t.coords[0]}${t.coords[1]}`,i=t.getPossibleMoves(s,e);for(let t=0;t<i.length;t++){let s=i[t],c=document.querySelector(`[data-coords="${s[0]}${s[1]}"]`);c.addEventListener("click",(t=>{a.call(this,t,e)}));let r=document.createElement("div");r.classList.add("grey"),c.appendChild(r)}}clearPossibilities(){let t=document.querySelectorAll(".grey");for(let e=0;e<t.length;e++){let s=t[e].parentElement;s.removeChild(t[e]);const i=s.cloneNode(!0);s.replaceWith(i)}}createPiece(t,e){let s=new t(e,this.color);return this.pieces.push(s),s}attackChoice(t,e,s,i=!1){const c=document.querySelector(`[data-coords="${t}${e}"]`);c.classList.add("dying-square");const r=document.createElement("div");r.setAttribute("id","choiceBox");const o=document.createElement("button");o.textContent="SWORD ATTACK!",o.addEventListener("click",(c=>{i?(this.displaying.coords=[t,e],h(s)):(s[t][e].dead=!0,s[t][e]=this.displaying,this.displaying.coords=[t,e],h(s)),c.stopPropagation()}));const n=document.createElement("img");n.setAttribute("src","../../public/images/sword.png");const a=document.createElement("button");a.textContent="DYNAMITE ATTACK!",a.addEventListener("click",(i=>{this.displaying.dead=!0,s[t][e].dead=!0,function(t,e,s){let i=[[t,e],[t+1,e],[t+1,e+1],[t+1,e-1],[t,e+1],[t,e-1],[t-1,e+1],[t-1,e],[t-1,e-1]].filter((t=>t[0]>-1&&t[0]<8&&t[1]>-1&&t[1]<8));for(let t=0;t<i.length;t++){let e=s[i[t][0]][i[t][1]];void 0!==e&&(e.dead=!0,s[i[t][0]][i[t][1]]=void 0)}}(t,e,s),i.stopPropagation(),h(s),document.querySelector(`[data-coords="${t}${e}"]`).classList.add("exploding")}));const d=document.createElement("img");d.setAttribute("src","../../public/images/dynamite.png"),o.appendChild(n),a.appendChild(d),r.appendChild(o),r.appendChild(a),c.appendChild(r)}normalAttack(t,e,s){s[t][e].dead=!0,s[t][e]=this.displaying,this.displaying.coords=[t,e]}}class e{constructor(t,e){this.type=t,this.color=e,this.image=`../../public/images/pieces/${e} ${t}.png`}checkIfEmpty(t,e,s){return void 0===s[t][e]}checkIfEnemy(t,e,s){return s[t][e].color!==this.color}}class s extends e{constructor(t,e){super(t,e)}getPossibleMoves(t,e){let s=parseInt(t[0],10),i=parseInt(t[1],10);return[[s+1,i+2],[s+2,i+1],[s-1,i+2],[s-2,i+1],[s+1,i-2],[s+2,i-1],[s-2,i-1],[s-1,i-2]].reduce(((t,s)=>(s[0]<=7&&s[0]>=0&&s[1]<=7&&s[1]>=0&&(this.checkIfEmpty(s[0],s[1],e)||this.checkIfEnemy(s[0],s[1],e))&&t.push(s),t)),[])}}class i extends e{constructor(t,e){super(t,e),this.start=!0}getPossibleMoves(t,e){let s=parseInt(t[0],10),i=parseInt(t[1],10),c=[[s+1,i],[s+1,i+1],[s,i-1],[s-1,i],[s-1,i+1],[s-1,i-1],[s,i+1],[s+1,i-1]].reduce(((t,s)=>(s[0]<=7&&s[0]>=0&&s[1]<=7&&s[1]>=0&&(this.checkIfEmpty(s[0],s[1],e)||this.checkIfEnemy(s[0],s[1],e))&&t.push(s),t)),[]);return this.start&&this.checkIfEmpty(s+2,i,e)&&this.checkIfEmpty(s+1,i,e)&&e[s+3][i]&&e[s+3][i].start&&c.push([s+2,i]),this.start&&this.checkIfEmpty(s-1,i,e)&&this.checkIfEmpty(s-2,i,e)&&this.checkIfEmpty(s-3,i,e)&&void 0!==e[s-4][i]&&e[s-4][i].start&&c.push([s-2,i]),c}}class c extends e{constructor(t,e){super(t,e),this.start=!0}getPossibleMoves(t,e){let s=parseInt(t[0],10),i=parseInt(t[1],10),c=[];for(let t=1;i+t<8;t++)this.checkIfEmpty(s,i+t,e)?c.push([s,i+t]):this.checkIfEnemy(s,i+t,e)?(c.push([s,i+t]),t=8):t=8;for(let t=1;i-t>-1;t++)this.checkIfEmpty(s,i-t,e)?c.push([s,i-t]):this.checkIfEnemy(s,i-t,e)?(c.push([s,i-t]),t=8):t=8;for(let t=1;s+t<8;t++)this.checkIfEmpty(s+t,i,e)?c.push([s+t,i]):this.checkIfEnemy(s+t,i,e)?(c.push([s+t,i]),t=8):t=8;for(let t=1;s-t>-1;t++)this.checkIfEmpty(s-t,i,e)?c.push([s-t,i]):this.checkIfEnemy(s-t,i,e)?(c.push([s-t,i]),t=8):t=8;return c}}class r extends e{constructor(t,e){super(t,e)}getPossibleMoves(t,e){let s=parseInt(t[0],10),i=parseInt(t[1],10),c=[];for(let t=1;s+t<8&&i+t<8;t++)this.checkIfEmpty(s+t,i+t,e)?c.push([s+t,i+t]):this.checkIfEnemy(s+t,i+t,e)?(c.push([s+t,i+t]),t=8):t=8;for(let t=1;s+t<8&&i-t>-1;t++)this.checkIfEmpty(s+t,i-t,e)?c.push([s+t,i-t]):this.checkIfEnemy(s+t,i-t,e)?(c.push([s+t,i-t]),t=8):t=8;for(let t=1;s-t>-1&&i+t<8;t++)this.checkIfEmpty(s-t,i+t,e)?c.push([s-t,i+t]):this.checkIfEnemy(s-t,i+t,e)?(c.push([s-t,i+t]),t=8):t=8;for(let t=1;s-t>-1&&i-t>-1;t++)this.checkIfEmpty(s-t,i-t,e)?c.push([s-t,i-t]):this.checkIfEnemy(s-t,i-t,e)?(c.push([s-t,i-t]),t=8):t=8;return c}}class o extends e{constructor(t,e){super(t,e),this.rookMoves=c.prototype.getPossibleMoves,this.bishopMoves=r.prototype.getPossibleMoves}getPossibleMoves(t,e){let s=[];return this.rookMoves(t,e).forEach((t=>{s.push(t)})),this.bishopMoves(t,e).forEach((t=>{s.push(t)})),s}}class n extends e{constructor(t,e){super(t,e),this.start=!0}getPossibleMoves(t,e){let s=parseInt(t[0],10),i=parseInt(t[1],10),c={white:[[s,i+1],[s+1,i+1],[s-1,i+1]],black:[[s,i-1],[s+1,i-1],[s-1,i-1]]}[this.color].reduce(((t,s,i)=>(s[0]<8&&s[0]>-1&&s[1]<8&&s[1]>-1&&(this.checkIfEmpty(s[0],s[1],e)?0===i&&t.push([s[0],s[1]]):0!==i&&this.checkIfEnemy(s[0],s[1],e)&&t.push([s[0],s[1]])),t)),[]);return this.start&&"white"===this.color&&this.checkIfEmpty(s,i+1,e)&&this.checkIfEmpty(s,i+2,e)&&c.push([s,i+2]),this.start&&"black"===this.color&&this.checkIfEmpty(s,i-1,e)&&this.checkIfEmpty(s,i-2,e)&&c.push([s,i-2]),this.checkIfEnpasant(s+1,i,e)&&c.push([]),c}checkIfEnpasant(t,e,s){return!!(t>-1&&t<8&&e>-1&&e<8&&void 0!==s[t][e]&&s[t][e].enpasant&&s[t][e].color!==this.color)}promotingOrAttacking(t,e,s,i){this.checkIfEmpty(t,e,s)?(d(this,t,e,s),this.promoteBox(s)):(s[t][e].dead=!0,d(this,t,e,s),this.promoteBox(s,!0,i))}promoteBox(t,e=!1,i){const a=document.querySelector(`[data-coords="${this.coords[0]}${this.coords[1]}"]`),d=document.createElement("div");d.classList.add("promotingChoiceBox");const l=[[r,"bishop"],[s,"knight"],[n,"pawn"],[o,"queen"],[c,"rook"]];for(let s=0;s<l.length;s++){const c=document.createElement("img");c.setAttribute("src",`../../public/images/pieces/${this.color} ${l[s][1]}.png`),c.addEventListener("click",(c=>{c.stopPropagation(),this.promote(l[s][0],l[s][1],t),e?(t.parent.cleanDOM(),t.parent.render(),i.attackChoice(this.coords[0],this.coords[1],t,!0)):h(t)})),d.appendChild(c)}a.appendChild(d)}promote(t,e,s){let i=new t(e,this.color),c=this;c.getPossibleMoves=i.getPossibleMoves,c.promoted=!0,i.start=!1,Object.assign(c,i)}}function a(t,e){e.parent.cleanDOM(),e.parent.render();const s=this.displaying.coords[0],i=this.displaying.coords[1],c=Number(t.target.dataset.coords[0]),r=Number(t.target.dataset.coords[1]);this.displaying.start=!1,e[s][i]=void 0,"pawn"!==this.displaying.type||this.displaying.promoted||0!==r&&7!==r?this.displaying.checkIfEmpty(c,r,e)?(d(this.displaying,c,r,e),h(e)):this.attackChoice(c,r,e):this.displaying.promotingOrAttacking(c,r,e,this)}function h(t){t.parent.cleanDOM(),t.parent.render(),t.parent.checkForEnd()?alert("game has ended"):t.parent.changeTurn()}function d(t,e,s,i){t.coords=[e,s],i[e][s]=t}return{Gameboard:class{constructor(){this.board=[new Array(8),new Array(8),new Array(8),new Array(8),new Array(8),new Array(8),new Array(8),new Array(8)],this.board.parent=this,this.table=document.getElementById("board"),this.players=[],this.turn=0}cleanDOM(){for(;this.table.firstChild;)this.table.removeChild(this.table.firstChild)}start(){this.table.classList.add("board");let e=new t("white",this.board);this.players.push(e);let a=new t("black",this.board);this.players.push(a);let h=[[r,"bishop"],[s,"knight"],[c,"rook"]];this.players.forEach(((t,e)=>{let s=e?6:1;for(let e=0,i=0;e<8;e++)d(t.createPiece(n,"pawn"),i+e,s,this.board);s=e?7:0,d(t.createPiece(i,"king"),4,s,this.board),d(t.createPiece(o,"queen"),3,s,this.board);let c=2;h.reduce(((e,i,r)=>{d(t.createPiece(i[0],i[1]),c-r,s,this.board)}),[]),c=5,h.reduce(((e,i,r)=>{d(t.createPiece(i[0],i[1]),c+r,s,this.board)}),[])})),setTimeout((()=>{this.changeTurn()}),0)}render(){let t=!1;for(let e=0;e<8;e++){let s=document.createElement("tr");s.setAttribute("class","tableRow");for(let i=0;i<8;i++){let c=document.createElement("td");if(c.setAttribute("data-coords",`${e}${i}`),c.classList.add("board-square"),t?(c.classList.add("green"),t=!1):(c.classList.add("white"),t=!0),this.board[e][i]){let t=document.createElement("img");t.setAttribute("src",this.board[e][i].image),t.classList.add("pieceImg"),c.appendChild(t)}s.appendChild(c)}t=!t,this.table.appendChild(s)}}checkForEnd(){if(this.players[0].pieces[8].dead||this.players[1].pieces[8].dead)return!0}changeTurn(){1===this.turn?(this.players[1].humanCanClick(this.board),this.turn=0):(this.turn=1,this.players[0].humanCanClick(this.board))}},Knight:s,King:i,Rook:c,Bishop:r,Queen:o,Pawn:n}}().Gameboard);e.start(),e.render()}t.addEventListener("click",i),e.addEventListener("click",i)}()})();