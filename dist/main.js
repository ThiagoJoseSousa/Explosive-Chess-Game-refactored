(()=>{"use strict";(()=>{const e=e=>{const t=[];let o=!1;return{setHuman:function(){o=!0},addPiece:function(e){t.push(e)},getKing:function(){return t[14]},getLegalCoords:function(e,t){const o=e.getMoves();let i;i="getFarCoords"===e.finalFilter?o.possibilities:n.getInBoard(o);const r=n.findPieces(t,i);return n[e.finalFilter](this,i,r,t)},getPieceIndex:function(e){for(let o=0;o<t.length;o++)if(e===t[o])return o;return-1},setAllPiecesOnBoard:function(e){t.forEach((t=>{e.setToSquare(t)}))},pieces:t}},t=(e,t,i)=>({getMoves:function(){return o[this.type](e[0][0],e[1][0])},changeCoords:function(t,o){e[0][0]=t,e[1][0]=o},move:function(e,t,o){o.removeFromSquare(this),this.changeCoords(e,t),o.setToSquare(this)},normalAttack:function(e,t,o){const n=o.lookForPiece(e,t);n.dead=!0,o.removeFromSquare(n),this.move(e,t,o)},explodeAttack:function(e,t,o){let i=[[e=parseInt(e,10),t=parseInt(t,10)],[e+1,t],[e-1,t],[e,t-1],[e-1,t-1],[e+1,t-1],[e,t+1],[e-1,t+1],[e+1,t+1]];i=n.getInBoard({possibilities:i}),i.forEach((e=>{const t=o.lookForPiece(e[0],e[1]);t&&(t.dead=!0,o.removeFromSquare(t))})),this.dead=!0,o.removeFromSquare(this)},coords:e,type:t,finalFilter:i}),o={knight:(e,t)=>({initialCoords:[e,t],possibilities:[[e+1,t+2],[e+2,t+1],[e-1,t+2],[e-2,t+1],[e+1,t-2],[e+2,t-1],[e-2,t-1],[e-1,t-2]]}),king:(e,t)=>({initialCoords:[e,t],possibilities:[[e+1,t],[e+1,t+1],[e,t-1],[e-1,t],[e-1,t+1],[e-1,t-1],[e,t+1],[e+1,t-1],[e+2,t],[e-2,t]]}),rook(e,t){const o=[e,t],n=[];for(let o=1;t+o<8;o++)n.push([e,t+o]);for(let o=1;t-o>-1;o++)n.push([e,t-o]);for(let o=1;e-o>-1;o++)n.push([e-o,t]);for(let o=1;e+o<8;o++)n.push([e+o,t]);return{initialCoords:o,possibilities:n}},bishop(e,t){const o=[e,t],n=[];for(let o=1;e+o<8&&t+o<8;o++)n.push([e+o,t+o]);for(let o=1;e+o<8&&t-o>-1;o++)n.push([e+o,t-o]);for(let o=1;e-o>-1&&t+o<8;o++)n.push([e-o,t+o]);for(let o=1;e-o>-1&&t-o>-1;o++)n.push([e-o,t-o]);return{initialCoords:o,possibilities:n}},queen(e,t){return{initialCoords:[e,t],possibilities:[...this.rook(e,t).possibilities,...this.bishop(e,t).possibilities]}},whitePawn(e,t){const o=[e,t],n=[[e,t+1],[e,t+2],[e+1,t+1],[e-1,t+1]];return n[0].straight=!0,n[1].twoStraight=!0,{initialCoords:o,possibilities:n}},blackPawn(e,t){const o=[e,t],n=[[e,t-1],[e,t-2],[e+1,t-1],[e-1,t-1]];return n[0].straight=!0,n[1].twoStraight=!0,{initialCoords:o,possibilities:n}}},n={getInBoard:e=>e.possibilities.filter((e=>e[0]<8&&e[0]>-1&&e[1]<8&&e[1]>-1)),findPieces:(e,t)=>t.reduce(((t,o,n)=>(e.lookForPiece(o[0],o[1])&&t.push(n),t)),[]),findMovesBeyondPieceI(e,t){let o,n;for(;e[t];){if(t===e.length-1)return t+1;if(o=e[t+1][0]-e[t][0],n=e[t+1][1]-e[t][1],o>1||o<-1||n>1||n<-1)return t+1;t++}return e.length},pieceIsEnemy:(e,t)=>-1===e.getPieceIndex(t)&&t,getFarCoords(e,t,o,n){if(!o)return t;const i=o.map((e=>this.findMovesBeyondPieceI(t,e))),r=[...t];return i.forEach(((e,t)=>{this.undefineAToB(o[t],e,r)})),o.forEach(((o,s)=>{if(i[s]!==i[s-1]){const i=this.pieceIsEnemy(e,n.lookForPiece(t[o][0],t[o][1]));i&&r.push(i.coords)}})),r},getShortCoords(e,t,o,n){return o?(o.forEach((o=>{this.pieceIsEnemy(e,n.lookForPiece(t[o][0],t[o][1]))||(t[o]=void 0)})),t):t},getPawnCoords(e,t,o,n){let i=this.getShortCoords(e,t,o,n);return i=i.filter(((o,i)=>{if(!o)return;const r=this.pieceIsEnemy(e,n.lookForPiece(t[i][0],t[i][1]));return o.twoStraight&&(!t[i-1]||n.lookForPiece(t[i-1][0],t[i-1][1]))||(o.straight||o.twoStraight)&&r||!(o.straight||o.twoStraight||r)?void 0:o})),i},undefineAToB(e,t,o){for(;e!==t;)o[e]=void 0,e++}},i={addPawns(e,o){let n;n=1===o?"whitePawn":"blackPawn";for(let i=0;i<8;i++){const c=t([[i],[o]],n,"getPawnCoords");c.isNewYPromote=r,c.promotePiece=s,e.addPiece(c)}},addRooks(e,o){const n=t([[0],[o]],"rook","getFarCoords"),i=t([[7],[o]],"rook","getFarCoords");e.addPiece(n),e.addPiece(i)},addKnights(e,o){const n=t([[1],[o]],"knight","getShortCoords"),i=t([[6],[o]],"knight","getShortCoords");e.addPiece(n),e.addPiece(i)},addBishops(e,o){const n=t([[2],[o]],"bishop","getFarCoords"),i=t([[5],[o]],"bishop","getFarCoords");e.addPiece(n),e.addPiece(i)},addKing(e,o){const n=t([[4],[o]],"king","getShortCoords");e.addPiece(n)},addQueen(e,o){const n=t([[3],[o]],"queen","getFarCoords");e.addPiece(n)}};function r(e){return 7===e||0===e}function s(e){delete this.isNewYPromote,"whitePawn"!==e&&"blackPawn"!==e&&(this.type=e,"queen"!==e&&"rook"!==e&&"bishop"!==e?"knight"===e&&(this.finalFilter="getShortCoords"):this.finalFilter="getFarCoords")}const c=document.getElementById("board");function a(){c.classList.add("board");let e=!1;for(let t=0;t<8;t++){const o=document.createElement("tr");o.setAttribute("class","tableRow");for(let n=0;n<8;n++){const i=document.createElement("td");i.setAttribute("data-coords",`${t}${n}`),i.classList.add("board-square"),d(e,i),e=!e,o.appendChild(i)}c.appendChild(o),e=!e}}function d(e,t){e?t.classList.add("green"):t.classList.add("white")}function l(){for(;c.firstChild;)c.removeChild(c.firstChild)}function u(e,t,o){const n=c.querySelector(`[data-coords='${e}${t}']`),i=document.createElement("img");i.setAttribute("src",o),i.classList.add("pieceImg"),n.appendChild(i)}function h(e,t,o){const n=c.querySelector(`[data-coords="${e[0]}${e[1]}"]`);n.classList.add("dying-square");const i=document.createElement("div");i.setAttribute("id","choiceBox");const r=document.createElement("button");r.textContent="SWORD ATTACK!";const s=document.createElement("img");s.setAttribute("src","../../public/images/sword.png"),r.appendChild(s),r.addEventListener("click",t);const a=document.createElement("button");a.textContent="DYNAMITE ATTACK!";const d=document.createElement("img");d.setAttribute("src","../../public/images/dynamite.png"),a.addEventListener("click",o),a.appendChild(d),i.appendChild(r),i.appendChild(a),n.appendChild(i)}function p(e,t,o){const n=c.querySelector(`[data-coords="${e[0]}${e[1]}"]`),i=document.createElement("div");i.classList.add("promotingChoiceBox");const r=["bishop","knight","queen","rook"];for(let e=0;e<r.length;e++){const n=document.createElement("img");n.setAttribute("src",`../../public/images/pieces/${t} ${r[e]}.png`),n.addEventListener("click",o),i.appendChild(n)}const s=document.createElement("img");s.setAttribute("src",`../../public/images/pieces/${t} ${t}Pawn.png`),s.addEventListener("click",o),i.appendChild(s),n.appendChild(i)}a();const g=function(){const t=(()=>{const e=[new Array(8),new Array(8),new Array(8),new Array(8),new Array(8),new Array(8),new Array(8),new Array(8)],t=[];let o=!0;return{addPlayer:function(e){t.push(e)},checkForEnd:function(){const e=t[0].getKing(),o=t[1].getKing();return e.dead&&o.dead?"draw":e.dead?"black":!!o.dead&&"white"},changeTurn:function(){o=!0!==o,f(o?t[0]:t[1])},setToSquare:function(t){const{coords:o}=t;e[o[0][0]][o[1][0]]=t},removeFromSquare:function(t){const{coords:o}=t;e[o[0][0]][o[1][0]]=void 0},lookForPiece:function(t,o){if(t=parseInt(t,10),o=parseInt(o,10),e[t][o])return e[t][o]},getPieceColor:function(e){return-1!==t[0].getPieceIndex(e)?"white":"black"},players:t,turn:o}})(),o=e(),n=e();t.addPlayer(o),t.addPlayer(n),i.addPawns(o,1);for(const e in i)i.hasOwnProperty(e)&&"addPawns"!==e&&i[e](o,0);i.addPawns(n,6);for(const e in i)i.hasOwnProperty(e)&&"addPawns"!==e&&i[e](n,7);return o.setAllPiecesOnBoard(t),n.setAllPiecesOnBoard(t),t}();function m(){const e={whitePlayer:g.players[0].pieces,blackPlayer:g.players[1].pieces};let t="white";for(const o in e)e.hasOwnProperty(o)&&(e[o].forEach((e=>{e.dead||u(e.coords[0],e.coords[1],`../../public/images/pieces/${t} ${e.type}.png`)})),t="black")}function f(e){const t=g.checkForEnd();t?function(e){const t=document.createElement("div");t.classList.add("endDisplay");const o=document.createElement("p");o.textContent=`${e} has won the game!`,t.style.height=`${c.clientHeight}px`,t.style.width=`${c.clientWidth}px`,t.appendChild(o),c.parentElement.appendChild(t)}(t):e.pieces.forEach((t=>{t.dead||function(e,t,o){const n=c.querySelector(`[data-coords='${e}${t}']`);n.classList.add("clickablePiece"),n.addEventListener("click",(()=>{!function(e,t){(function(){const e=document.getElementsByClassName("grey");for(;e.length>0;){let t=e[0].parentElement;t.removeChild(e[0]);const o=t.cloneNode(!0);t.replaceWith(o)}})(),e.forEach((e=>{if(!e)return;e=[parseInt(e[0],10),parseInt(e[1],10)];const o=c.querySelector(`[data-coords='${e[0]}${e[1]}']`),n=document.createElement("div");n.classList.add("grey"),o.appendChild(n),o.addEventListener("click",(()=>{l(),a(),function(e,t){const o=g.lookForPiece(t.dataset.coords[0],t.dataset.coords[1]);let n="move";o.isNewYPromote&&o.isNewYPromote(e[1])&&(n+="Promote"),g.lookForPiece(e[0],e[1])&&(n+="Attack"),P[n](o,e)}(e,t)}))}))}(o,n)}))}(t.coords[0],t.coords[1],e.getLegalCoords(t,g))}))}m(),f(g.players[0]);const P={move(e,t){e.move(t[0],t[1],g),g.changeTurn(),m()},moveAttack(e,t){m(),h(t,(()=>{e.normalAttack(t[0],t[1],g),l(),a(),g.changeTurn(),m()}),(()=>{e.explodeAttack(t[0],t[1],g),l(),a(),g.changeTurn(),m();const o=document.querySelector(`[data-coords="${t[0]}${t[1]}"]`);o.addEventListener("animationend",(()=>{o.classList.remove("exploding")})),o.classList.add("exploding")}))},movePromote(e,t){const o=g.getPieceColor(e);e.move(t[0],t[1],g),m(),p(t,o,(t=>{e.promotePiece(C(t)),l(),a(),g.changeTurn(),m()}))},movePromoteAttack(e,t){const o=g.getPieceColor(e);e.normalAttack(t[0],t[1],g),m(),p(t,o,(o=>{e.promotePiece(C(o)),l(),a(),m(),h(t,(()=>{l(),a(),g.changeTurn(),m()}),(()=>{e.explodeAttack(t[0],t[1],g),l(),a(),g.changeTurn(),m();const o=document.querySelector(`[data-coords="${t[0]}${t[1]}"]`);o.addEventListener("animationend",(()=>{o.classList.remove("exploding")})),o.classList.add("exploding")}))}))}};function C(e){const t=e.target.src;return t.slice(51,t.length-4)}!function(){const e=document.querySelector(".hamburguer"),t=document.querySelector(".nav-list");e.addEventListener("click",(()=>{e.classList.toggle("active"),t.classList.toggle("active")}))}(),function(){const e=document.getElementsByClassName("nav-item"),t=document.querySelectorAll("section");for(let t=0;t<e.length;t++)e[t].addEventListener("click",o);function o(e){for(let e=0;e<t.length;e++)t[e].classList.add("notcurrent");t[e.target.dataset.page].classList.remove("notcurrent")}}()})()})();